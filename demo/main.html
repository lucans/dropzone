<!DOCTYPE html>
<html ng-app="app" class="grey lighten-4 grey-text">
	<head>
		<meta charset="utf-8">
		<title>ng-dropzone simple example</title>
		
		<!-- AngularJS -->
		<script src="../src/js/angular.min.js"></script>
		
		<!-- Dropzone -->
		<script src="../src/js/dropzone.js"></script>
		<script src="../src/js/ng-dropzone.js"></script>
		<link rel="stylesheet" href="../src/css/dropzone.css">		
		<link rel="stylesheet" href="../dist/ng-dropzone.min.css">


		<!-- Clipboard -->
		<script src="../src/js/clipboard.min.js"></script>
		<script src="../src/js/ng-clipboard.js"></script>

		<!-- Bootstrap -->
		<!-- <link rel="stylesheet" href="../src/css/bootstrap.min.css"> -->		

		<!-- Materialize -->
		<link rel="stylesheet" href="../src/css/materialize.min.css">

		<!-- Font awesome -->
		<link rel="stylesheet" href="../src/css/font-awesome.min.css">
	
		<style>
			body{
				font-family:'Roboto', sans-serif !important;				
			}
			.green-text{
				transition: 1s;
				color: #449d44;
			}
			.btn{
				margin-right: 3px;
			}		
			.container{
				margin-top: 30px;
			}	
			#final_string{
				max-height: 165px;
				min-height: 165px;
/*
				max-width: 472px;
				min-width: 472px;*/
			}

		/*	#dropzone1{
				max-height: 165px;
				min-height: 165px;

				max-width: 472px;
				min-width: 472px;
			}*/
			.card-title{
				font-weight: bold;
				/*color: white;*/
			}
			.page-footer{
				position: absolute;
				bottom: 0;
				width: 100%;
			}
		</style>

	</head>


	<body>

	<div class="container" ng-controller="drop1Controller">		
		<div class="row">	

		<h3>Minify your CSS files</h3>
		<p>
			The <b>minification</b> procedure removes all <b>unnecessary</b> content from the code, but without affecting its operation. <br>
			Here you can <b>easily minify</b> your css files to <b>optimize</b> your project!
		</p>
			<div class="card col m12" ng-class="{'green lighten-5' : response_upload == 'success'}">							
				<span class="card-title"><center>DROP YOUR FILES HERE</center></span>
				<div class="card-content">
					<div class="form-group">
						<div class="dropzone" id="dropzone1" options="dzOptions" callbacks="dzCallbacks" ng-dropzone></div>										
					</div>				
				</div>
				<div class="card-action" ng-show="response_upload == 'success' && fileAdded">
					<button ng-click="getClean()" class="btn green">Minify</button>																	
				</div>
			</div>	

			<div class="progress" ng-show="loadbar">
		     	<div class="indeterminate"></div>
		  	</div>

			<div class="card blue lighten-4 col m12" ng-show="result.final_string.length > 0">				
				<span class="card-title white-text"><center>HERE'S YOUR CLEAN CSS</center></span>
				<div class="card-content">
					<div class="form-group">								
					    <textarea class="white" ng-model="result.final_string" id="final_string"></textarea>			
					</div>		

				 <div class="row">
			        <div class="col m3">
			          <div class="card blue">
			            <div class="card-content white-text">
			              <span class="card-title"><small>Input</small></span>
			              <p><big>{{result.antes}}</big> characters</p>
			            </div>           
			          </div>
			        </div>
			    
			        <div class="col m3">
			          <div class="card blue">
			            <div class="card-content white-text">
			              <span class="card-title"><small>Output</small></span>
			              <p><big>{{result.depois}}</big> characters</p>
			            </div>           
			          </div>
			        </div>
			      
			        <div class="col m6">
			          <div class="card green darken-1">
			            <div class="card-content white-text">
			              <span class="card-title">You saved</span>
			              <p><big>{{result.percent}}</big> <i class="fa fa-percent"></i></p>
			            </div>           
			          </div>
			        </div>
			      </div>

				</div>
				<div class="card-action">									
					<button class="btn" ngclipboard data-clipboard-target="#final_string" ng-class="{'blue darken-1' : result.final_string.length > 0}" ng-disabled="!result.final_string">Copy all <i class="fa fa-clone"></i></button>					
					<button class="btn right" ng-disabled="!result.final_string" ng-click="result.final_string = ''">Clear</i></button>					
					<!-- <button class="btn right" ng-class="{'btn-primary' : final_string.length > 0}" ng-disabled="!final_string">Download as file <i class="fa fa-download"></i></button> -->
				</div>
			</div>		

		</div>
	</div>		


	<script>
		Dropzone.autoDiscover = false;
		var app = angular.module('app', ['thatisuday.dropzone','ngclipboard']);
		
		app.config(function(dropzoneOpsProvider){
			dropzoneOpsProvider.setOptions({
				url : 'upload_1.php?func=upload',
				acceptedFiles : '.css',
				addRemoveLinks : true,
				dictDefaultMessage : 'Click to add or drop .css files',
				dictRemoveFile : 'Remove',
				dictResponseError : 'Could not upload this photo',
				filename : 'teste'			
			});
		});
		
		// Dropzone 1
		app.controller('drop1Controller', function($scope, $timeout, $http){
			$scope.dzOptions = {
				paramName : 'file',
				maxFilesize : '10',
				  	init: function() {
				        this.on("success", function(responseText) {
			            	// console.log(responseText);
			                // $scope.getClean();
				        });
				    }
			};
			
			$scope.dzCallbacks = {
		           'addedfile': function(file) {
                        $scope.file = file;

                        var aux = file.name.substring(0, 10) + '..<b>.css<b/>';                    	

                        $scope.$apply(function() {
                            $scope.fileAdded = true;
                        });

                        var preview = document.getElementsByClassName('dz-preview');
			            preview = preview[preview.length - 1];

			            var imageName = document.createElement('span');
			            imageName.innerHTML = aux;

			            preview.insertBefore(imageName, preview.firstChild);

			            var aux = '';

                    },

                    'success': function (file, response) {
                    	$scope.response_upload = response;
                    	console.log(response);
                    }
			};

			$scope.getClean = function(){			
				$scope.loadbar = true;
				
		        $http.get("upload_1.php?func=clean_files").success(function(result){					  
					$scope.result = result;				   
					$scope.loadbar = false;
				});			
			}

		});	
	</script>
	
	</body>		

</html>

